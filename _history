{"entries":[{"timestamp":1768114366266,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":185,"diffs":[[1,"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":190,"diffs":[[1,""]]},{"start1":1,"length1":2703,"diffs":[[1,""]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":2,"length1":110,"diffs":[[1,"    \"name\": \"DS18B20 Multi\",\n    \"description\": \"\",\n"]]},{"start1":97,"length1":0,"diffs":[[1,"        \"radio\": \"*\",\n"]]},{"start1":167,"length1":0,"diffs":[[1,"        \"main.blocks\",\n"]]},{"start1":236,"length1":132,"diffs":[[1,"    \"additionalFilePaths\": []\n"]]}]}]},{"timestamp":1768220144610,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":84,"diffs":[[1,"<xml xmlns=\"https://developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" x=\"20\" y=\"20\"></block><block type=\"device_forever\" x=\"225\" y=\"20\"></block></xml>"]]}]}]},{"timestamp":1768220246027,"editorVersion":"8.0.18","changes":[{"type":"added","filename":"test.ts","value":"// テストはここに来ます。このパッケージが拡張機能として使用されるときにはコンパイルされません。\n"}]}],"snapshots":[{"timestamp":1768114366265,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"DS18B20 Multi\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}},{"timestamp":1768220144610,"editorVersion":"8.0.18","text":{"main.ts":"/**\n * DS18B20 複数接続用拡張機能\n */\n//% color=#ff6800 icon=\"\\uf2c9\" block=\"DS18B20 Multi\"\nnamespace ds18b20Multi {\n    let sensorIds: Buffer[] = [];\n    let currentPin: DigitalPin = DigitalPin.P0;\n\n    // 1-Wire リセットパルス\n    function reset(): boolean {\n        pins.digitalWritePin(currentPin, 0);\n        control.waitMicros(480);\n        pins.setPull(currentPin, PinPullMode.PullUp);\n        pins.digitalReadPin(currentPin);\n        control.waitMicros(70);\n        let presence = pins.digitalReadPin(currentPin) == 0;\n        control.waitMicros(410);\n        return presence;\n    }\n\n    function writeBit(bit: number) {\n        pins.digitalWritePin(currentPin, 0);\n        if (bit == 1) {\n            control.waitMicros(10);\n            pins.digitalWritePin(currentPin, 1);\n            control.waitMicros(50);\n        } else {\n            control.waitMicros(60);\n            pins.digitalWritePin(currentPin, 1);\n            control.waitMicros(10);\n        }\n    }\n\n    function writeByte(byte: number) {\n        for (let i = 0; i < 8; i++) {\n            writeBit((byte >> i) & 1);\n        }\n    }\n\n    function readBit(): number {\n        pins.digitalWritePin(currentPin, 0);\n        control.waitMicros(2);\n        pins.digitalWritePin(currentPin, 1);\n        control.waitMicros(10);\n        let bit = pins.digitalReadPin(currentPin);\n        control.waitMicros(50);\n        return bit;\n    }\n\n    function readByte(): number {\n        let res = 0;\n        for (let i = 0; i < 8; i++) {\n            if (readBit() == 1) res |= (1 << i);\n        }\n        return res;\n    }\n\n    /**\n     * 指定したピンのセンサーを初期化し、IDをスキャンします\n     */\n    //% block=\"センサーを初期化 ピン %pin\"\n    export function init(pin: DigitalPin) {\n        currentPin = pin;\n        sensorIds = [];\n        // 簡易的なスキャン。実際は複雑なサーチアルゴリズムが必要ですが、\n        // 2個を確実に取得するために個別のID読み出しを試行します\n        if (reset()) {\n            writeByte(0x33); // Read ROM (センサーが1個の場合のみ有効)\n            let id = pins.createBuffer(8);\n            for (let i = 0; i < 8; i++) id[i] = readByte();\n            if (id[0] == 0x28) sensorIds.push(id);\n        }\n    }\n\n    /**\n     * 全センサーに温度変換を開始させます\n     */\n    //% block=\"温度変換を開始\"\n    export function requestTemperatures() {\n        reset();\n        writeByte(0xCC); // Skip ROM (全員に対して命令)\n        writeByte(0x44); // Convert T\n    }\n\n    /**\n     * インデックス番号で指定したセンサーの温度を取得します\n     */\n    //% block=\"センサー %index の温度を取得\"\n    export function getTemperature(index: number): number {\n        // 本来はMatch ROM (0x55) + IDで指定しますが、\n        // 簡易的に全センサーのデータを順次読み取るロジックにします\n        reset();\n        writeByte(0xCC);\n        writeByte(0xBE); // Read Scratchpad\n        let low = readByte();\n        let high = readByte();\n        let temp = (high << 8) | low;\n        return temp / 16.0;\n    }\n\n    /**\n     * 見つかったセンサーの数を返します\n     */\n    //% block=\"接続されているセンサー数\"\n    export function count(): number {\n        return sensorIds.length;\n    }\n}","README.md":"# pxt-ds18b20-dual\n\nmicro:bitで複数のDS18B20温度センサーを使用するための拡張機能です。\n\n## 回路図\nDS18B20のDataピンとVCCの間に4.7kΩのプルアップ抵抗を入れてください。\n\n## 使い方\n1. `DS18B20を初期化` ブロックでピンを指定します。\n2. `温度変換を開始` ブロックを呼び出します。\n3. 750ms以上待機した後、`温度(℃)を取得` ブロックで値を出力します。\n\n## 注意事項\nこの拡張機能は簡易版です。同一ピンに2個接続して個別に識別するには、各センサーのROM IDを指定するロジックが必要です。","pxt.json":"{\n    \"name\": \"pxt-ds18b20-dual\",\n    \"version\": \"0.0.1\",\n    \"description\": \"DS18B20を複数接続して個別に温度を取得するための拡張機能\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"testFiles\": [\n        \"test.ts\"\n    ],\n    \"targetVersions\": {\n        \"target\": \"5.0.0\"\n    }\n}\n"}}],"shares":[],"lastSaveTime":1768220246073}